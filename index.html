<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Prime X Music — Search & Play</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#030311; --panel: rgba(255,255,255,0.03);
    --neon1:#00f0ff; --neon2:#7cff5f; --accent:#ff0077;
  }
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:linear-gradient(180deg,#030311,#071026);color:#e6f7ff}
  .wrap{max-width:1200px;margin:24px auto;padding:18px;display:grid;grid-template-columns:360px 1fr;gap:18px}
  header{grid-column:1/3;display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo{width:48px;height:48px;border-radius:8px;background:linear-gradient(90deg,var(--neon1),var(--neon2));display:flex;align-items:center;justify-content:center;color:#001;font-weight:800}
  h1{margin:0;font-size:18px}
  .search{display:flex;gap:8px}
  input.searchbox{padding:10px 12px;border-radius:10px;border:none;width:380px;background:#061428;color:#e6f7ff}
  button.searchBtn{padding:10px 14px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#002;cursor:pointer;font-weight:700}

  /* left menu / feed */
  .panel{background:var(--panel);border-radius:12px;padding:14px;box-shadow:0 8px 28px rgba(0,0,0,0.6)}
  .section-title{font-weight:700;color:var(--neon1);margin-bottom:10px}
  .suggestions{display:flex;flex-direction:column;gap:10px}
  .sug{padding:10px;border-radius:8px;background:rgba(255,255,255,0.02);cursor:pointer}
  .sug small{display:block;color:#a9cbd6;margin-top:4px}

  /* results list */
  .results{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px}
  .card{background:rgba(255,255,255,0.02);border-radius:10px;padding:10px;display:flex;gap:10px;align-items:flex-start}
  .thumb{width:140px;height:84px;border-radius:8px;background:#111;flex-shrink:0;object-fit:cover}
  .meta{flex:1}
  .meta h3{margin:0;font-size:14px}
  .meta p{margin:6px 0 0;color:#9fb4c0;font-size:12px}

  /* player sticky bottom-mini */
  .miniPlayer{
    position:fixed;left:18px;right:18px;bottom:18px;height:86px;background:linear-gradient(90deg,rgba(0,0,0,0.55),rgba(2,8,20,0.6));border-radius:12px;display:flex;align-items:center;padding:10px;gap:12px;z-index:60;box-shadow:0 18px 40px rgba(0,0,0,0.6)
  }
  .miniThumb{width:68px;height:68px;border-radius:8px;object-fit:cover}
  .miniInfo{flex:1}
  .miniTitle{font-weight:700}
  .miniControls{display:flex;gap:8px;align-items:center}
  .btn{padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--neon1),var(--neon2));color:#001;cursor:pointer;font-weight:700}

  .note{font-size:12px;color:#9fb4c0}

  /* modal new-user */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.65);display:flex;align-items:center;justify-content:center;z-index:80}
  .mcard{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:18px;border-radius:10px;text-align:center;width:320px}
  .mcard input{width:100%;padding:10px;border-radius:8px;border:none;background:rgba(255,255,255,0.03);color:#e6f7ff;margin-top:12px}

  @media (max-width:980px){.wrap{grid-template-columns:1fr}.miniPlayer{left:10px;right:10px}}
</style>
</head>
<body>

<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo">PX</div>
      <div>
        <h1>Prime X Music</h1>
        <div class="note">Search • Play • Background-friendly</div>
      </div>
    </div>

    <div class="search">
      <input class="searchbox" id="q" placeholder="Search songs, artists, albums..." />
      <button class="searchBtn" id="searchBtn">Search</button>
    </div>
  </header>

  <!-- Left column: categories / quick feed -->
  <aside class="panel">
    <div class="section-title">Quick Picks</div>
    <div class="suggestions">
      <div class="sug" data-q="Top Hits 2024">Top Hits 2024 <small>Latest trending songs</small></div>
      <div class="sug" data-q="Bollywood hits">Bollywood hits <small>Popular Indian songs</small></div>
      <div class="sug" data-q="Lo-fi chill beats">Lo-fi chill beats <small>Study / Relax</small></div>
      <div class="sug" data-q="Party mix">Party mix <small>Dance & EDM</small></div>
    </div>

    <div style="height:18px"></div>
    <div class="section-title">About</div>
    <div class="note">Join our Telegram: <a href="https://t.me/primexprem" target="_blank" style="color:var(--neon2)">t.me/primexprem</a></div>
    <div style="height:12px"></div>
    <div class="section-title">Tips</div>
    <div class="note">Press Play once to allow background playback. Browser autoplay rules may require a gesture.</div>
  </aside>

  <!-- Main results area -->
  <main>
    <div id="resultsContainer" class="panel">
      <div id="feedTitle" class="section-title">Trending Music</div>
      <div id="results" class="results"></div>
      <div id="loadMoreWrap" style="text-align:center;margin-top:12px"><button id="loadMore" class="btn" style="display:none">Load more</button></div>
    </div>
  </main>
</div>

<!-- mini player -->
<div id="mini" class="miniPlayer" style="display:none">
  <img id="miniThumb" class="miniThumb" src="" alt="thumb">
  <div class="miniInfo">
    <div id="miniTitle" class="miniTitle">—</div>
    <div id="miniChannel" class="note">Prime X</div>
    <div id="miniProgress" style="height:6px;background:rgba(255,255,255,0.04);border-radius:6px;margin-top:8px;overflow:hidden"><div id="miniBar" style="height:100%;width:0;background:linear-gradient(90deg,var(--neon1),var(--neon2));"></div></div>
  </div>
  <div class="miniControls">
    <button id="miniPrev" class="btn">Prev</button>
    <button id="miniPlay" class="btn">Play</button>
    <button id="miniNext" class="btn">Next</button>
  </div>
</div>

<!-- new user modal -->
<div id="modal" class="modal" style="display:none">
  <div class="mcard">
    <h3 style="color:var(--neon1)">Welcome to Prime X Music</h3>
    <p class="note">Enter your name to continue and join our Telegram for latest campaigns.</p>
    <input id="uname" placeholder="Enter your name (optional)" />
    <div style="margin-top:12px">
      <button id="joinBtn" class="btn">Continue</button>
    </div>
    <div style="margin-top:10px" class="note">Join Telegram: <a href="https://t.me/primexprem" target="_blank" style="color:var(--neon2)">t.me/primexprem</a></div>
  </div>
</div>

<!-- YouTube IFrame API and script -->
<script>
/* ====== CONFIGURE HERE ====== */
const YT_API_KEY = 'YOUR_YOUTUBE_API_KEY'; // <-- set your YouTube Data API v3 key
const DEFAULT_QUERY = 'Top Hits 2024';     // home feed query
let nextPageToken = null;
let lastQuery = DEFAULT_QUERY;

/* ====== Helpers: DOM ====== */
const resultsEl = document.getElementById('results');
const feedTitle = document.getElementById('feedTitle');
const loadMoreBtn = document.getElementById('loadMore');

/* ====== Simple playlist state ====== */
let queue = [];
let curIndex = -1;
let player; // YT player instance
let progressInterval;

/* ====== Initialize UI & handlers ====== */
document.getElementById('searchBtn').addEventListener('click', ()=> search(document.getElementById('q').value.trim() || DEFAULT_QUERY));
document.getElementById('q').addEventListener('keydown', e=>{ if(e.key==='Enter') document.getElementById('searchBtn').click(); });
document.querySelectorAll('.sug').forEach(s=> s.addEventListener('click', ()=>{ search(s.dataset.q); document.getElementById('q').value = s.dataset.q;}));
loadMoreBtn.addEventListener('click', ()=> search(lastQuery, nextPageToken));

/* ====== New-user modal logic ====== */
if(!localStorage.getItem('px_user')) {
  document.getElementById('modal').style.display = 'flex';
}
document.getElementById('joinBtn').addEventListener('click', ()=>{
  const name = document.getElementById('uname').value.trim();
  if(name) localStorage.setItem('px_user', name);
  else localStorage.setItem('px_user', 'Guest');
  document.getElementById('modal').style.display = 'none';
  alert('Welcome! Join Telegram for updates: https://t.me/primexprem');
});

/* ====== YouTube Data API search ====== */
async function search(q, pageToken=null){
  if(!YT_API_KEY || YT_API_KEY === 'YOUR_YOUTUBE_API_KEY'){ alert('Set your YouTube API key in code (YT_API_KEY).'); return; }
  lastQuery = q;
  feedTitle.innerText = `Results for: ${q}`;
  resultsEl.innerHTML = `<div class="note">Searching ${q} ...</div>`;
  loadMoreBtn.style.display = 'none';

  const params = new URLSearchParams({
    key: YT_API_KEY,
    part: 'snippet',
    q: q,
    maxResults: 12,
    type: 'video'
  });
  if(pageToken) params.set('pageToken', pageToken);

  try{
    const res = await fetch('https://www.googleapis.com/youtube/v3/search?' + params.toString());
    const j = await res.json();
    if(j.error){ console.error(j.error); resultsEl.innerHTML = `<div class="note">API error: ${j.error.message}</div>`; return; }
    nextPageToken = j.nextPageToken || null;
    renderResults(j.items, pageToken ? true:false);
    if(nextPageToken) loadMoreBtn.style.display = 'inline-block';
    else loadMoreBtn.style.display = 'none';
  }catch(err){
    console.error(err); resultsEl.innerHTML = `<div class="note">Network error</div>`;
  }
}

/* ====== Render results ====== */
function renderResults(items, append=false){
  if(!append) resultsEl.innerHTML = '';
  items.forEach(it=>{
    const vid = it.id.videoId;
    const title = it.snippet.title;
    const channel = it.snippet.channelTitle;
    const thumb = it.snippet.thumbnails.medium.url;
    const card = document.createElement('div');
    card.className = 'card';
    card.innerHTML = `
      <img class="thumb" src="${thumb}" loading="lazy">
      <div class="meta">
        <h3>${escapeHtml(title)}</h3>
        <p>${escapeHtml(channel)}</p>
        <div style="margin-top:8px"><button class="btn playNow" data-id="${vid}" data-title="${escapeAttr(title)}" data-thumb="${thumb}" data-channel="${escapeAttr(channel)}">Play</button></div>
      </div>
    `;
    resultsEl.appendChild(card);
  });

  // attach handlers to play buttons
  document.querySelectorAll('.playNow').forEach(b=>{
    b.addEventListener('click', ()=> {
      const id = b.dataset.id;
      const title = b.dataset.title;
      const thumb = b.dataset.thumb;
      const channel = b.dataset.channel;
      enqueueAndPlay({ id, title, thumb, channel });
    });
  });
}

/* ====== Simple queue & player control ====== */
function enqueueAndPlay(track){
  // add to queue
  queue.push(track);
  curIndex = queue.length - 1;
  loadTrack(curIndex);
}

function loadTrack(index){
  if(index < 0 || index >= queue.length) return;
  const t = queue[index];
  showMini(t);
  if(!player){
    // create YT iframe player
    createPlayer(t.id);
  } else {
    player.loadVideoById(t.id);
    // ensure visible
    document.getElementById('mini').style.display = 'flex';
    document.getElementById('miniPlay').innerText = 'Pause';
  }
}

function createPlayer(videoId){
  // load iframe api script if not loaded
  if(typeof YT === 'undefined' || typeof YT.Player === 'undefined'){
    const tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    document.head.appendChild(tag);
    // wait for API to be ready: YT will call onYouTubeIframeAPIReady
    window.onYouTubeIframeAPIReady = ()=> {
      player = new YT.Player('ytPlayer', { // invisible iframe holder
        height: '0', width:'0', videoId: videoId,
        playerVars: { autoplay: 1, controls: 0, modestbranding:1, rel:0 },
        events: { 'onReady': ()=> player.playVideo(), 'onStateChange': onPlayerStateChange }
      });
    };
    // create holder element (hidden)
    const h = document.createElement('div'); h.id = 'ytPlayer'; h.style.display='none'; document.body.appendChild(h);
  } else {
    player = new YT.Player('ytPlayer', { height:'0', width:'0', videoId: videoId, playerVars: { autoplay:1, controls:0 }, events:{ 'onStateChange': onPlayerStateChange }});
  }
  document.getElementById('mini').style.display = 'flex';
  document.getElementById('miniPlay').innerText = 'Pause';
}

/* ====== player events and mini controls ====== */
function onPlayerStateChange(evt){
  const state = evt.data;
  if(state === YT.PlayerState.PLAYING) {
    startProgress();
    document.getElementById('miniPlay').innerText = 'Pause';
  } else if(state === YT.PlayerState.PAUSED) {
    stopProgress();
    document.getElementById('miniPlay').innerText = 'Play';
  } else if(state === YT.PlayerState.ENDED) {
    stopProgress();
    // autoplay next in queue if exists
    if(curIndex + 1 < queue.length){ curIndex++; loadTrack(curIndex); }
    else { document.getElementById('miniPlay').innerText = 'Play'; }
  }
}

document.getElementById('miniPlay').addEventListener('click', ()=>{
  if(!player) return;
  const st = player.getPlayerState();
  if(st === YT.PlayerState.PLAYING) player.pauseVideo();
  else player.playVideo();
});
document.getElementById('miniNext').addEventListener('click', ()=>{ if(curIndex + 1 < queue.length){ curIndex++; loadTrack(curIndex);} });
document.getElementById('miniPrev').addEventListener('click', ()=>{ if(curIndex - 1 >= 0){ curIndex--; loadTrack(curIndex);} });

function showMini(track){
  document.getElementById('miniThumb').src = track.thumb;
  document.getElementById('miniTitle').innerText = track.title;
  document.getElementById('miniChannel').innerText = track.channel;
  document.getElementById('mini').style.display = 'flex';
}

/* progress bar */
function startProgress(){
  stopProgress();
  progressInterval = setInterval(()=>{
    try{
      const dur = player.getDuration();
      const cur = player.getCurrentTime();
      const pct = dur ? (cur/dur)*100 : 0;
      document.getElementById('miniBar').style.width = pct + '%';
    }catch(e){}
  }, 400);
}
function stopProgress(){ clearInterval(progressInterval); }

/* Escape HTML helpers */
function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, function(m){ return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; }); }
function escapeAttr(s){ return (s||'').replace(/"/g,'&quot;'); }

/* ====== Initial default search (home feed) ====== */
search(DEFAULT_QUERY);

/* ====== Notes for usage ======
 - Replace YT_API_KEY with your API key.
 - Autoplay with sound might be blocked until user interacts with the page.
 - You can extend: use videos.list to fetch viewCount/duration via video IDs (requires extra API calls).
 - To show trending via videos.list?chart=mostPopular use separate endpoint (requires regionCode param).
================================= */

</script>
</body>
</html>
